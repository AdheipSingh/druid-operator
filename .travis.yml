language: go

go:
  - 1.13.x

services:
  - docker

jobs:
  include:
    - stage: Unit Test
      name: "Unit Test"
      script:
        - make test

    - stage: Build and Deploy
      name: "Docker Build"
      script:
        - docker build -t localhost:5000/druid-io:latest .
        
    - stage: Build and Deploy
      name: "kind"
      addons:
        snaps:
        - name: kubectl
          confinement: classic
      script:
        -  GO111MODULE=on go get sigs.k8s.io/kind
        -  ./scripts/kind.sh
        -  docker push localhost:5000/druid-io:latest
        -  kubectl get nodes
